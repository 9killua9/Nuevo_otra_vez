<!DOCTYPE html>
<html>
  <head>
    <title>Capture Photo</title>
    <script type="text/javascript" charset="utf-8" src="js/cordova-2.3.0.js"></script>
    <script type="text/javascript" charset="utf-8">

    var pictureSource;   // picture source
    var destinationType; // sets the format of returned value 

    // Wait for Cordova to connect with the device
    //
    document.addEventListener("deviceready",onDeviceReady,false);

    // Cordova is ready
    //
    function onDeviceReady() {
        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
    }

    var fileSystem;

//generic getById
function getById(id) {
    return document.querySelector(id);
}
//generic content logger
function logit(s) {
    getById("#content").innerHTML += s;
}

//generic error handler
function onError(e) {
    getById("#content").innerHTML = "<h2>Error</h2>"+e.toString();
}

function doDeleteFile(e) {
    fileSystem.root.getFile("test.txt", {create:true}, function(f) {
        f.remove(function() {
            logit("File removed<p/>"); 
        });
    }, onError);
}

function metadataFile(m) {
    logit("File was last modified "+m.modificationTime+"<p/>");    
}

function doMetadataFile(e) {
    fileSystem.root.getFile("test.txt", {create:true}, function(f) {
        f.getMetadata(metadataFile,onError);
    }, onError);
}

function readFile(f) {
    reader = new FileReader();
    reader.onloadend = function(e) {
        console.log("go to end");
        logit("<pre>" + e.target.result + "</pre><p/>");
    }
    reader.readAsText(f);
}

function doReadFile(e) {
    fileSystem.root.getFile("test.txt", {create:true}, readFile, onError);
}

function appendFile(f) {

    f.createWriter(function(writerOb) {
        writerOb.onwrite=function() {
            logit("Done writing to file.<p/>");
        }
        //go to the end of the file...
        writerOb.seek(writerOb.length);
        writerOb.write("Test at "+new Date().toString() + "\n");
    })

}

function doAppendFile(e) {
    fileSystem.root.getFile("test.txt", {create:true}, appendFile, onError);
}

function gotFiles(entries) {
    var s = "";
    for(var i=0,len=entries.length; i<len; i++) {
        //entry objects include: isFile, isDirectory, name, fullPath
        s+= entries[i].fullPath;
        if (entries[i].isFile) {
            s += " [F]";
        }
        else {
            s += " [D]";
        }
        s += "<br/>";
        
    }
    s+="<p/>";
    logit(s);
}

function doDirectoryListing(e) {
    //get a directory reader from our FS
    var dirReader = fileSystem.root.createReader();

    dirReader.readEntries(gotFiles,onError);        
}

function onFSSuccess(fs) {
    fileSystem = fs;

    getById("#dirListingButton").addEventListener("touchstart",doDirectoryListing);            
    getById("#addFileButton").addEventListener("touchstart",doAppendFile);            
    getById("#readFileButton").addEventListener("touchstart",doReadFile);            
    getById("#metadataFileButton").addEventListener("touchstart",doMetadataFile);            
    getById("#deleteFileButton").addEventListener("touchstart",doDeleteFile);            
    
    logit( "Got the file system: "+fileSystem.name +"<br/>" +
                                    "root entry name is "+fileSystem.root.name + "<p/>")    

    doDirectoryListing();
} 

function onDeviceReady() {

    //request the persistent file system
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError);
    }
    </script>
    <!-- CSS -->
            <link rel="stylesheet" type="text/css" href="css/gral.css" />
            <link rel="stylesheet" type="text/css" href="css/jquerycss.css" />
            <link rel="stylesheet" type="text/css" href="css/site.css" />
            <!-- Jquerys  -->
            <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
            <script type="text/javascript" charset="utf-8" src="js/jquerymobile.js"></script>
            <script type="text/javascript" charset="utf-8" src="js/gral.js?v=6"></script>
  </head>

  <body  onload="funcionesDeCarga()" style="background-color:#3b3b3b">
    <div class="oculto">
      <div id="guardaCelular"></div>
    </div>
    <div data-role="page" id="etapaInicial">
      <div data-role="header">
        <h1>Ingresa !</h1>
      </div><!-- /header -->
      <div data-role="content">   
        <div class=""> Nro Celular </div>
        <input type="text" name="numero" id="numero" value="" placeholder="11355689XX" />
        
        <div class=""> Mail </div>
        <input type="email" name="email" id="email" value="" placeholder="minombreyapellido@hotmail.es" />
        <input type="button" id="validar" value=" Entrar " data-transition="fade" data-role="button" data-inline="true" />
        
          <!-- BORRAR DESPUES -->
        <button id="addFileButton">Create/Append to Test File</button>
        <button id="readFileButton">Read Test File</button>
        <button id="metadataFileButton">Get Test File Metadata</button>
        <button id="deleteFileButton">Delete Test File</button>
        <button id="dirListingButton">Show Directory Contents</button>

        <div id="content"></div>

      </div><!-- /content -->
  </div><!-- /page -->

    <div data-role="page" id="etapa0">
      <div data-role="header">
        <h1>Bienvenido</h1>
      </div><!-- /header -->
      <div data-role="content">
          <div class="backTotal w100"> Total : <span id="total"> </span></div>
          <a href="#etapa1" data-transition="fade" data-role="button" data-icon="search"> Qu&eacute; gast&eacute;? </a>
          <a href="#etapa4" data-transition="fade" data-role="button" data-icon="search"> Qu&eacute; cobr&eacute;? </a>
          <a href="#etapa2" id="resumen" data-role="button" data-icon="search"> Ver Resumen <a>
          <div class="oculto" id="cargainicialmenucontenedor"><a href="#etapa3" id="cargaInicialMenu" class="oculto" data-role="button" data-icon="search"> Cargar monto inicial <a>  </div>
      </div><!-- /content -->
  </div><!-- /page -->

  <div data-role="page" id="etapa1">
    <div data-role="header">
      <h1>Qu&eacute; gast&eacute;?</h1>
    </div><!-- /header -->
    <div data-role="content">   
        <div class=""> Monto </div>
        <input type="text" name="gasto" id="name" value="" placeholder="ej: 300" />

        <div class=""> Causa </div>
        <input type="text" name="causa" id="causa" value="" placeholder="ej:Farmacity - (no obligatorio)" />
        
        <input type="button" id="enviarGasto" value=" Cargar " data-transition="fade" data-role="button" data-inline="true" />

        <a href="#etapa0" data-transition="fade" data-role="button" data-inline="true">Volver al menu</a>
    </div><!-- /content -->
  </div><!-- /page -->

  <div data-role="page" id="etapa2">
    <div data-role="header">
      <h1>Ver resumen de gastos</h1>
    </div><!-- /header -->
    <div data-role="content">
        <a href="#etapa0" data-transition="fade" data-role="button" data-inline="true">Volver al menu</a>
        <div class="resumen" id="muestraResumen">
            
        </div>
    </div><!-- /content -->
  </div><!-- /page -->

  <div data-role="page" id="etapa3">
    <div data-role="header">
      <h1>Carga del monto inicial</h1>
    </div><!-- /header -->
    <div data-role="content">   
        <input type="text" name="gasto" id="cargainicial" value="" placeholder="ej: 300" />
        <input type="button" id="enviar" value=" Cargar " data-transition="fade" data-role="button" data-inline="true" />

        <a href="#etapa0" data-transition="fade" data-role="button" data-inline="true">Volver al menu</a>
    </div><!-- /content -->
  </div><!-- /page -->

  <div data-role="page" id="etapa4">
    <div data-role="header">
      <h1>Qu&eacute; cobr&eacute; ?</h1>
    </div><!-- /header -->
    <div data-role="content">   
        <div class=""> Monto </div>
        <input type="text" name="cobro" id="cobroinicial" value="" placeholder="ej: 300" />

        <div class=""> Cliente </div>
        <input type="text" name="cliente" id="cliente" value="" placeholder="ej:Farmacity - (no obligatorio)" />
        
        <input type="button" id="enviarCobro" value=" Cargar " data-transition="fade" data-role="button" data-inline="true" />

        <a href="#etapa0" data-transition="fade" data-role="button" data-inline="true">Volver al menu</a>
    </div><!-- /content -->
  </div><!-- /page -->
</form>
  </body>
</html>